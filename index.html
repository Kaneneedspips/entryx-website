<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EntryX Live Trading Journal</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a0e14; color: #e8eaed; line-height: 1.6; padding: 40px 20px; }
        
        .container { max-width: 1200px; margin: 0 auto; }
        
        .header { text-align: center; margin-bottom: 40px; }
        .logo { font-size: 28px; font-weight: 900; color: #cbff38; margin-bottom: 10px; }
        .subtitle { color: #64748b; font-size: 14px; }
        .live-badge { display: inline-flex; align-items: center; gap: 8px; background: rgba(34, 197, 94, 0.1); padding: 8px 16px; border-radius: 50px; font-size: 13px; color: #22c55e; font-weight: 600; margin-top: 15px; }
        .live-dot { width: 8px; height: 8px; background: #22c55e; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
        
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(203, 255, 56, 0.2); border-radius: 12px; padding: 20px; text-align: center; }
        .stat-label { font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
        .stat-value { font-size: 28px; font-weight: 800; color: #cbff38; }
        .stat-value.negative { color: #ef4444; }
        
        .equity-section { background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(203, 255, 56, 0.2); border-radius: 12px; padding: 25px; margin-bottom: 40px; }
        .equity-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .equity-title { font-size: 16px; font-weight: 600; color: #ffffff; }
        .equity-value { font-size: 24px; font-weight: 800; color: #cbff38; }
        .equity-change { font-size: 14px; color: #22c55e; margin-left: 10px; }
        .equity-change.negative { color: #ef4444; }
        .equity-chart { height: 150px; }
        .equity-svg { width: 100%; height: 100%; }
        .equity-line { fill: none; stroke: url(#eqGradient); stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }
        .equity-area { fill: url(#eqAreaGradient); }
        
        .trades-section { background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(203, 255, 56, 0.2); border-radius: 12px; overflow: hidden; }
        .trades-header { padding: 20px 25px; border-bottom: 1px solid rgba(203, 255, 56, 0.1); }
        .trades-title { font-size: 16px; font-weight: 600; color: #ffffff; }
        
        .trades-table { width: 100%; border-collapse: collapse; }
        .trades-table th { background: rgba(203, 255, 56, 0.05); padding: 12px 15px; text-align: left; font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
        .trades-table td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 14px; }
        .trades-table tr:hover { background: rgba(203, 255, 56, 0.03); }
        
        .trade-buy { color: #22c55e; font-weight: 600; }
        .trade-sell { color: #ef4444; font-weight: 600; }
        .profit-positive { color: #22c55e; font-weight: 700; }
        .profit-negative { color: #ef4444; font-weight: 700; }
        
        .symbol-badge { background: rgba(203, 255, 56, 0.1); padding: 4px 10px; border-radius: 6px; font-size: 12px; color: #cbff38; font-weight: 600; }
        
        .empty-state { text-align: center; padding: 60px 20px; color: #64748b; }
        
        .updated { text-align: center; margin-top: 30px; font-size: 12px; color: #64748b; }
        
        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .trades-table { font-size: 12px; }
            .trades-table th, .trades-table td { padding: 10px 8px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">ENTRYX</div>
            <div class="subtitle">Live Trading Journal</div>
            <div class="live-badge"><span class="live-dot"></span> Live Updates</div>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Balance</div>
                <div class="stat-value" id="balance">£1,000</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Profit</div>
                <div class="stat-value" id="totalProfit">£0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Win Rate</div>
                <div class="stat-value" id="winRate">0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Trades</div>
                <div class="stat-value" id="totalTrades">0</div>
            </div>
        </div>
        
        <div class="equity-section">
            <div class="equity-header">
                <div class="equity-title">Equity Curve</div>
                <div>
                    <span class="equity-value" id="equityValue">£1,000</span>
                    <span class="equity-change" id="equityChange">+0%</span>
                </div>
            </div>
            <div class="equity-chart">
                <svg class="equity-svg" viewBox="0 0 800 150" preserveAspectRatio="none" id="equityChart">
                    <defs>
                        <linearGradient id="eqGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#cbff38"/>
                            <stop offset="100%" style="stop-color:#7c3aed"/>
                        </linearGradient>
                        <linearGradient id="eqAreaGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#cbff38;stop-opacity:0.2"/>
                            <stop offset="100%" style="stop-color:#cbff38;stop-opacity:0"/>
                        </linearGradient>
                    </defs>
                    <path class="equity-area" id="eqArea" d="M0,150 L800,150 Z"/>
                    <path class="equity-line" id="eqLine" d="M0,75 L800,75"/>
                </svg>
            </div>
        </div>
        
        <div class="trades-section">
            <div class="trades-header">
                <div class="trades-title">Trade History</div>
            </div>
            <table class="trades-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Symbol</th>
                        <th>Type</th>
                        <th>Lots</th>
                        <th>Entry</th>
                        <th>Exit</th>
                        <th>Profit</th>
                    </tr>
                </thead>
                <tbody id="tradesBody">
                    <tr><td colspan="7" class="empty-state">Loading trades...</td></tr>
                </tbody>
            </table>
        </div>
        
        <div class="updated" id="lastUpdated">Last updated: --</div>
    </div>
    
    <script>
        const REPO_URL = 'https://raw.githubusercontent.com/Kaneneedspips/entryx-live-report/main';
        
        async function loadData() {
            await loadTrades();
            await loadEquity();
        }
        
        async function loadTrades() {
            try {
                const response = await fetch(REPO_URL + '/trades.csv?' + Date.now());
                const csv = await response.text();
                const trades = parseCSV(csv);
                displayTrades(trades);
                calculateStats(trades);
            } catch (e) {
                console.log('Error loading trades:', e);
                document.getElementById('tradesBody').innerHTML = '<tr><td colspan="7" class="empty-state">No trades yet</td></tr>';
            }
        }
        
        async function loadEquity() {
            try {
                const response = await fetch(REPO_URL + '/equity.json?' + Date.now());
                const data = await response.json();
                
                document.getElementById('equityValue').textContent = '£' + data.balance.toLocaleString();
                document.getElementById('balance').textContent = '£' + data.balance.toLocaleString();
                
                const change = ((data.balance - data.startBalance) / data.startBalance * 100).toFixed(1);
                const changeEl = document.getElementById('equityChange');
                changeEl.textContent = (change >= 0 ? '+' : '') + change + '%';
                changeEl.className = 'equity-change' + (change < 0 ? ' negative' : '');
                
                if (data.history && data.history.length > 1) {
                    drawEquityCurve(data.history);
                }
                
                document.getElementById('lastUpdated').textContent = 'Last updated: ' + data.updated;
            } catch (e) {
                console.log('Error loading equity:', e);
            }
        }
        
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            if (lines.length < 2) return [];
            
            const trades = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                if (values.length >= 7) {
                    trades.push({
                        date: values[0],
                        symbol: values[1],
                        type: values[2],
                        lots: parseFloat(values[3]),
                        entry: parseFloat(values[4]),
                        exit: parseFloat(values[5]),
                        profit: parseFloat(values[6])
                    });
                }
            }
            return trades.reverse();
        }
        
        function displayTrades(trades) {
            const tbody = document.getElementById('tradesBody');
            
            if (trades.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state">No trades yet</td></tr>';
                return;
            }
            
            tbody.innerHTML = trades.map(trade => `
                <tr>
                    <td>${trade.date}</td>
                    <td><span class="symbol-badge">${trade.symbol}</span></td>
                    <td class="${trade.type.toLowerCase() === 'buy' ? 'trade-buy' : 'trade-sell'}">${trade.type}</td>
                    <td>${trade.lots.toFixed(2)}</td>
                    <td>${trade.entry.toFixed(2)}</td>
                    <td>${trade.exit.toFixed(2)}</td>
                    <td class="${trade.profit >= 0 ? 'profit-positive' : 'profit-negative'}">£${trade.profit.toFixed(2)}</td>
                </tr>
            `).join('');
        }
        
        function calculateStats(trades) {
            if (trades.length === 0) return;
            
            const totalProfit = trades.reduce((sum, t) => sum + t.profit, 0);
            const wins = trades.filter(t => t.profit > 0).length;
            const winRate = (wins / trades.length * 100).toFixed(0);
            
            const profitEl = document.getElementById('totalProfit');
            profitEl.textContent = '£' + totalProfit.toFixed(2);
            profitEl.className = 'stat-value' + (totalProfit < 0 ? ' negative' : '');
            
            document.getElementById('winRate').textContent = winRate + '%';
            document.getElementById('totalTrades').textContent = trades.length;
        }
        
        function drawEquityCurve(points) {
            const width = 800;
            const height = 150;
            const padding = 10;
            
            const min = Math.min(...points) * 0.98;
            const max = Math.max(...points) * 1.02;
            const xStep = width / (points.length - 1);
            const yScale = (height - padding * 2) / (max - min);
            
            let linePath = '';
            let areaPath = '';
            
            points.forEach((val, i) => {
                const x = i * xStep;
                const y = height - padding - (val - min) * yScale;
                
                if (i === 0) {
                    linePath += `M${x},${y}`;
                    areaPath += `M${x},${y}`;
                } else {
                    linePath += ` L${x},${y}`;
                    areaPath += ` L${x},${y}`;
                }
            });
            
            areaPath += ` L${width},${height} L0,${height} Z`;
            
            document.getElementById('eqLine').setAttribute('d', linePath);
            document.getElementById('eqArea').setAttribute('d', areaPath);
        }
        
        loadData();
        setInterval(loadData, 5 * 60 * 1000);
    </script>
</body>
</html>
